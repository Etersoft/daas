Шаблоны
-------
В daas для генерирования различных файлов используются шаблоны формата jinja2.
Шаблоны по умолчанию лежат в каталоге /usr/share/daas/templates.
Но пользователь может определять свои или переопределять системные шаблоны.
Во время генерирования в порядке приоритета шаблоны ищутся в следующих каталогах:

- ./templates
- .daas/templates
- /usr/share/daas/templates.d
- /usr/share/daas/templates

При этом будет использован первый найденный шаблон.
Поэтому для того чтобы переопределить системный шаблон, достаточно положить файл
с таким же именем в каталог ./templates или .daas/templates

Системный каталог /usr/share/daas/templates.d служит для системных пользовательских шаблонов.
Т.е. подразумевается, что в этот каталог ставяться шаблоны из сторонних пакетов.


Шаблоны для Dockerfile
----------------------
Для каждого узла в файле проекта, может быть указан шаблон по которому генерируется Dockerfile.
Пример:

```yaml
groups:
    group1:
      nodes:
        builder:
          image: x64.p8-builder
```

Свойство **image** задаёт шаблон для сборки образа, а также это название может быть в дальнейшем 
использовано в имени запускаемого контейнера. В общем случае название файла шаблона формируется 
по форме ***Dockerfile.IMAGE_NAME.tpl***.
Т.е. в данном примере будет использован файл *Dockerfile.x64.p8-builder.tpl*.

Свойство **image** можно указывать сразу для группы узлов
Пример:

```yaml
groups:
    group2:
      image: x64.p8-group2
      nodes:
        node1:
           ...
        node2:
           ...
        node3:
           ...
```

Тогда для каждого узла входящего в группу будет использован шаблон *'Dockerfile.x64.p8-group2.tpl'*.
Так же разрешено одновременное указание шаблона для группы и "переопределение" шаблона для конкретного
узла.
Пример:

```yaml
groups:
    group3:
      image: x64.p8-group3
      nodes:
        node1:
           ...
        node2:
           image: x64.p8-special-node2
           ...
        node3:
           ...
```

Если свойство *image* не указано, то по умолчанию используется шаблон *'Dockerfile.default.tpl'*, который
соответственно вы можете переопределить на свой, положив в пользовательский каталог. 
Поставляемый default-шаблон базируется на **fotengauer/altlinux-p8** с добавлением 
*mc openssh-clients openssh-server console-scripts*.

Разрешено также указывать **image** как подкаталог, относительно основного каталога с шаблонами.
Например:
```
image: x86_64/p8/controller
```
В этом случае будет использован шаблон x86_64/p8/Dockerfile.controller.tpl относительно каталогов с шаблонами.
При этом в итоговом имени образа которое попадёт в docker-compose.yml все *'/'* будут заменены на *'.'*
```
image: x86_64.p8.controller
```

При использовании шаблонов следует иметь ввиду, что написание собственных шаблонов должно быть
последним инструментом, если никакие другие способы  не помогают. 
Надо не забывать, что для расширения "базовых" шаблонов иногда достаточно просто указать какие пакеты
необходимо доустановить ( см. [apt](docs/apt.md) ).

```yaml
        apt:
          sources:
            - "rpm file://xxx"
            - "rpm file://xxx"
          packages:
            - pack1
            - pack2

```

Для "собственоручного" формирования, есть так же базовый шаблон **image: x64_p8**, который просто собирается 
на образе *fotengauer/altlinux-p8* с добавлением того, что вы укажете в *apt/sources*, *copy* и т.п.


Шаблон для docker-compose.yml
-----------------------------
Помимо шаблонов используемых для получения Dockerfile, есть так же шаблон docker-compose.yml.tpl
Это шаблон по которому генерируется файл docker-compose.yml.
Его тоже можно переопределить, положив соответствующий файл в пользовательский каталог.
Но следует иметь ввиду, что это достаточно "многосложный" шаблон, завязанный на внутренную
структуру представления проекта. Поэтому пользовательская модифицикация может перестать работать
при очередном обновлении.


Рекомендации
------------
Для изучения того, какие шаблоны используются и соответственно, что можно "переопределить",
достаточно заглянуть в каталог *'/usr/share/daas/templates/'*.
